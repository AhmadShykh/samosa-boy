<section class="bg-pink-400 monsterrat">
  <h1
    class="text-white text-8xl font-thin text-center franxurter editable-text"
    id="editable-text"
    contenteditable="true"
    style="padding-top: 4rem; outline: none;"
  >
    HOW IT WORKS
  </h1>

  <div class="carousel-container custom-htw-parent p-20 items">
    <div class="carousel-track how-it-works-carousel">
      <div class="carousel-item">
        <div class="flex flex-col relative">
          <div
            class="rounded-full text-8xl franxurter bg-white custom-htw-child font-thin"
            style="left: calc(50% - 30px); top: -25px;"
          >
            1
          </div>

          <div class="custom-div-parent">
            <div class="custom-div-child-1 border border-black"></div>
            <div class="card-container border border-black p-4 bg-white rounded-3xl relative">
              <video
                class="object-cover"
                style="aspect-ratio: 0.8; width: 450px; height: 450px;"
                autoplay
                muted
                loop
            >
                <source
                    src="https://cdn.shopify.com/videos/c/o/v/f9513aece42e47f18125fca634b2ee55.mp4"
                    type="video/mp4"
                >
                Your browser does not support the video tag.
            </video>
            </div>
          </div>
          <div class="flex flex-col text-white mt-12">
            <h1 class="text-7xl franxurter font-thin text-white text-center">
              {{ section.settings.custom_text_1 }}
            </h1>
            <p class="text-center">Choose from our range of flavours</p>
          </div>
        </div>
      </div>
      <div class="carousel-item">
        <div class="flex flex-col relative">
          <div
            class="rounded-full text-8xl franxurter bg-white custom-htw-child font-thin"
            style="left: calc(50% - 30px); top: -25px;"
          >
            2
          </div>

          <div class="custom-div-parent">
            <div class="custom-div-child-1 border border-black"></div>
            <div class="card-container border border-black p-4 bg-white rounded-3xl relative">
              <video
                class="object-cover"
                style="aspect-ratio: 0.8; width: 450px; height: 450px;"
                autoplay
                muted
                loop
            >
                <source
                    src="https://cdn.shopify.com/videos/c/o/v/f9513aece42e47f18125fca634b2ee55.mp4"
                    type="video/mp4"
                >
                Your browser does not support the video tag.
            </video>
            </div>
          </div>
          <div class="flex flex-col text-white mt-12">
            <h1 class="text-7xl franxurter font-thin text-white text-center">
              {{ section.settings.custom_text_2 }}
            </h1>
            <p class="text-center">Choose from our range of flavours</p>
          </div>
        </div>
      </div>
      <div class="carousel-item">
        <div class="flex flex-col relative">
          <div
            class="rounded-full text-8xl franxurter bg-white custom-htw-child font-thin"
            style="left: calc(50% - 30px); top: -25px;"
          >
            3
          </div>

          <div class="custom-div-parent">
            <div class="custom-div-child-1 border border-black"></div>
            <div class="card-container border border-black p-4 bg-white rounded-3xl relative">
              <video
                class="object-cover"
                style="aspect-ratio: 0.8; width: 450px; height: 450px;"
                autoplay
                muted
                loop
            >
                <source
                    src="https://cdn.shopify.com/videos/c/o/v/f9513aece42e47f18125fca634b2ee55.mp4"
                    type="video/mp4"
                >
                Your browser does not support the video tag.
            </video>
            </div>
          </div>
          <div class="flex flex-col text-white mt-12">
            <h1 class="text-7xl franxurter font-thin text-white text-center">
              {{ section.settings.custom_text_3 }}
            </h1>
            <p class="text-center">Choose from our range of flavours</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .custom-div-parent {
    position: relative;
    z-index: 1;
  }

  .custom-div-child-1 {
    position: absolute;
    top: 5px;
    right: -5px;
    width: 100%;
    height: 100%;
    z-index: -1;
    background-color: rgb(196, 60, 114);
    border-radius: 20px;
  }

  .custom-height {
    height: 40rem;
  }

  .custom-text {
    height: 6rem;
  }

  .card-container {
    opacity: 0; /* Initially hidden */
    transform: translateX(100px) rotate(15deg); /* Start off-screen and rotated */
    transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
    animation: none; /* Animation only triggered by IntersectionObserver */
  }

  .card-container.visible {
    animation: flyIn 0.8s ease-in-out forwards; /* Trigger animation on visibility */
    opacity: 1;
  }

  /* Fly-in animation */
  @keyframes flyIn {
    0% {
      opacity: 0;
      transform: translateX(100px) rotate(15deg); /* Start off-screen and rotated */
    }
    70% {
      opacity: 1;
      transform: translateX(0px) rotate(5deg); /* Reduce rotation */
    }
    100% {
      transform: translateX(0) rotate(0deg); /* Settle to straight */
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const cards = document.querySelectorAll('.card-container');

    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible'); // Trigger fly-in animation
            observer.unobserve(entry.target); // Stop observing once animation is triggered
          }
        });
      },
      { threshold: 0.1 } // Trigger when 10% of the card is visible
    );

    cards.forEach((card) => observer.observe(card));
  });
</script>

{% style %}
  .custom-htw-parent {
    position: relative;
    z-index: 1;
    justify-content: center;
  }
  .custom-htw-child {
    position: absolute;
    width: 50px;
    height: 50px;
    z-index: 2;
    border-radius: 40px;
    /* font-weight: bold; */
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgb(196, 60, 114);
    font-weight: 400;
    padding: 30px;
    /* font-size: 3.5rem; */
  }
  .custom-grid-htw {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 40px;
    padding: 6rem 24rem;
    text-align: center;
  }
  .how-it-works-carousel {
    justify-content: center;
    align-items: center;
  }

  @media (max-width: 640px) {
    .custom-grid-htw {
      padding: 6rem 6rem;
    }
  }
  @media (min-width: 640px) {
    .custom-grid-htw {
      padding: 6rem 6rem;
      grid-template-columns: repeat(2, 1fr);
    }
    .how-it-works-carousel {
      margin-left: 0 !important;
    }
  }

  @media (max-width: 950px) {
    .how-it-works-carousel {
      flex-direction: column;
    }
    .carousel-item {
      margin-right: 0;
      margin-bottom: 3.5rem;
    }
  }

  @media (min-width: 1200px) {
    .custom-grid-htw {
      padding: 6rem 14rem;
      grid-template-columns: repeat(3, 1fr);
    }
    .how-it-works-carousel {
      margin-left: 0 !important;
    }
  }

  @keyframes typing {
    from {
      width: 0;
    }
    to {
      width: 100%;
    }
  }

  @keyframes blink-caret {
    from {
      border-color: transparent;
    }
    to {
      border-color: white;
    }
  }
  .editable-text {
    outline: none; /* Removes the focus outline */
    caret-color: white; /* Keeps the caret color consistent */
  }

  .typewriter {
    overflow: hidden; /* Hide overflowing text */
    white-space: nowrap; /* Keep the text on one line */
    border-right: 2px solid white; /* Simulate the caret */
    animation: blink-caret 0.75s step-end infinite;
    font-size: inherit;
  }
  /* Ensure no unwanted background is applied during editing */
  .editable-text:focus {
    background-color: transparent; /* Fixes white background issue */
    outline: none; /* Removes focus outline */
  }

  /* Placeholder style for an empty editable element */
  .editable-text:empty:before {
    content: 'HOW IT WORKS'; /* Placeholder text */
    color: rgba(255, 255, 255, 0.5); /* Light placeholder color */
    pointer-events: none; /* Prevents selecting the placeholder */
  }
{% endstyle %}

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const editableText = document.getElementById('editable-text');

    // Add a placeholder if the user clears the content
    editableText.addEventListener('input', function () {
      if (!editableText.textContent.trim()) {
        editableText.innerHTML = ''; // Clear any extra spaces
      }
    });

    // Prevent the element from disappearing on delete
    editableText.addEventListener('blur', function () {
      if (!editableText.textContent.trim()) {
        editableText.textContent = 'HOW IT WORKS'; // Restore default text
      }
    });
  });
</script>

{% schema %}
{
  "name": "how it works",
  "tag": "section",
  "settings": [
    {
      "type": "text",
      "id": "custom_text_1",
      "label": "Step 1 Heading",
      "default": "FILL"
    },
    {
      "type": "text",
      "id": "custom_text_2",
      "label": "Step 2 Heading",
      "default": "CHOOSE"
    },
    {
      "type": "text",
      "id": "custom_text_3",
      "label": "Step 3 Heading",
      "default": "ENJOY"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "how it works"
    }
  ]
}
{% endschema %}
